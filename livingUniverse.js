class SoulAI {
    constructor() {
        this.conversationDepth = 0;
        this.userName = 'ØµØ¯ÙŠÙ‚ØªÙŠ';
    }

    analyzeSoulMessage(message) {
        // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø¨Ø¹Ù…Ù‚
        const emotionalPatterns = {
            joy: ['Ø³Ø¹ÙŠØ¯Ø©', 'ÙØ±Ø­', 'Ø£Ù…Ù„', 'Ø­Ù…Ø§Ø³', 'Ø§Ù…ØªÙ†Ø§Ù†', 'Ø±Ø¶Ø§', 'Ø³Ù„Ø§Ù…'],
            sadness: ['Ø­Ø²ÙŠÙ†Ø©', 'Ø£Ù„Ù…', 'ÙŠØ£Ø³', 'ØªØ¹Ø¨', 'Ø¶ÙŠØ§Ø¹', 'ÙˆØ­Ø¯Ø©', 'Ø­Ø²Ù†'],
            anxiety: ['Ù‚Ù„Ù‚Ø©', 'ØªÙˆØªØ±', 'Ø®ÙˆÙ', 'ØªØ±Ø¯Ø¯', 'Ø§Ø¶Ø·Ø±Ø§Ø¨', 'Ù‡Ù„Ø¹'],
            growth: ['ØªØ¹Ù„Ù…', 'Ù†Ù…Ùˆ', 'ØªØºÙŠÙŠØ±', 'ØªØ·ÙˆØ±', 'Ø§ÙƒØªØ´Ø§Ù', 'ØªØ¬Ø¯ÙŠØ¯']
        };

        let soulState = { primary: 'contemplation', intensity: 0.5 };
        let messageLower = message.toLowerCase();

        // Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        for (let [emotion, words] of Object.entries(emotionalPatterns)) {
            if (words.some(word => messageLower.includes(word))) {
                soulState.primary = emotion;
                soulState.intensity = 0.8;
                break;
            }
        }

        return soulState;
    }

    generateSoulResponse(message, soulState) {
        this.conversationDepth++;
        
        const responseLibrary = {
            joy: [
                "ğŸŒ ÙØ±Ø­ÙƒÙ ÙŠØ¶ÙŠØ¡ Ø§Ù„ÙƒÙˆÙ† Ù…Ù† Ø­ÙˆÙ„ÙƒÙ! Ù‡Ù„ ÙŠÙ…ÙƒÙ†ÙƒÙ Ù…Ø´Ø§Ø±ÙƒØªÙŠ Ù…ØµØ¯Ø± Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ±ØŸ",
                "ğŸŒ¸ Ø£Ø±Ù‰ Ø²Ù‡ÙˆØ±Ø§Ù‹ ØªØªÙØªØ­ ÙÙŠ ÙƒÙ„Ù…Ø§ØªÙƒÙ... ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø£Ù† Ù†Ø±ÙˆÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù…Ø§Ù„ØŸ",
                "ğŸ’« Ø³Ø¹Ø§Ø¯ØªÙƒÙ Ù…Ø¹Ø¯ÙŠØ©! Ù…Ø§ Ø§Ù„Ø°ÙŠ Ø¬Ø¹Ù„ÙƒÙ ØªØ´Ø¹Ø±ÙŠÙ† Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø¬Ù…ÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø­ÙŠØ§Ø©ØŸ"
            ],
            sadness: [
                "ğŸŒ§ï¸ Ø£Ø­Ø³ Ø¨Ù†Ø¯Ù‰ Ø§Ù„Ø­Ø²Ù† ÙÙŠ ÙƒÙ„Ù…Ø§ØªÙƒÙ... ÙƒÙ„ Ù‚Ø·Ø±Ø© ØªØ­Ù…Ù„ Ù‚ØµØ©. Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† Ø­ÙƒØ§ÙŠØªÙ‡Ø§ØŸ",
                "ğŸ•¯ï¸ Ø§Ù„Ø£Ù„Ù… Ø§Ù„Ø°ÙŠ ØªØ´Ø¹Ø±ÙŠÙ† Ø¨Ù‡ Ù‡Ùˆ Ø´Ù…Ø¹Ø© ØªØ¶ÙŠØ¡ Ù…Ù†Ø§Ø·Ù‚ ØªØ­ØªØ§Ø¬ Ù„Ù„Ø±Ø¹Ø§ÙŠØ© ÙÙŠ Ø±ÙˆØ­ÙƒÙ.",
                "ğŸŒŒ Ø­ØªÙ‰ ÙÙŠ Ø£Ø­Ù„Ùƒ Ø§Ù„Ù„Ø­Ø¸Ø§ØªØŒ Ù‡Ù†Ø§Ùƒ Ù†Ø¬ÙˆÙ… ØªØ®ØªØ¨Ø¦... Ø¯Ø¹ÙŠÙ†Ø§ Ù†Ø¨Ø­Ø« Ø¹Ù†Ù‡Ø§ Ù…Ø¹Ø§Ù‹."
            ],
            anxiety: [
                "ğŸŒ€ Ø£ÙÙƒØ§Ø±ÙƒÙ ØªØ¯ÙˆØ± Ù…Ø«Ù„ Ø§Ù„Ø±ÙŠØ§Ø­... Ø¯Ø¹ÙŠÙ†Ø§ Ù†Ø¬Ø¯ Ù…Ø¹Ø§Ù‹ Ù…Ø±ÙƒØ² Ø§Ù„Ù‡Ø¯ÙˆØ¡ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ø§ØµÙØ©.",
                "ğŸŒŠ Ø§Ù„Ù‚Ù„Ù‚ Ù‡Ùˆ Ù…ÙˆØ¬ ÙŠØ®Ø¨Ø±Ù†Ø§ Ø£Ù†Ù†Ø§ Ø£Ø­ÙŠØ§Ø¡... ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø±ÙƒÙˆØ¨ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ù…ÙˆØ§Ø¬ Ù…Ø¹Ø§Ù‹ØŸ",
                "ğŸ ÙƒÙ„ Ù‚Ù„Ù‚ ÙŠØ­Ù…Ù„ Ø±Ø³Ø§Ù„Ø©... Ù…Ø§ Ø§Ù„Ø°ÙŠ ØªØ­Ø§ÙˆÙ„ Ù…Ø´Ø§Ø¹Ø±ÙƒÙ Ø¥Ø®Ø¨Ø§Ø±ÙƒÙ Ø¨Ù‡ØŸ"
            ],
            growth: [
                "ğŸŒ± Ø£Ø±Ù‰ Ø¨Ø°ÙˆØ± Ø§Ù„ØªØºÙŠÙŠØ± ÙÙŠ ÙƒÙ„Ù…Ø§ØªÙƒÙ... Ø£ÙŠ Ù†Ø¨Ø§Øª Ø¬Ù…ÙŠÙ„ ØªØ±ÙŠØ¯ÙŠÙ† Ø£Ù† ÙŠÙ†Ù…ÙˆØŸ",
                "ğŸ¦‹ Ø§Ù„ØªØ­ÙˆÙ„ Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…Ø®ÙŠÙØ§Ù‹ØŒ Ù„ÙƒÙ† look at you - ØªÙƒØ¨Ø±ÙŠÙ† ÙˆØªØªØ·ÙˆØ±ÙŠÙ†!",
                "ğŸ¨ Ø£Ù†ØªÙ Ø§Ù„ÙÙ†Ø§Ù†Ø© Ø§Ù„ØªÙŠ ØªØ±Ø³Ù… Ù…Ø³Ø§Ø±Ù‡Ø§... Ø£ÙŠ Ù„ÙˆÙ† ØªØ±ÙŠØ¯ÙŠÙ† Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„ÙˆØ­Ø© Ø­ÙŠØ§ØªÙƒÙØŸ"
            ],
            contemplation: [
                "ğŸ” Ø§Ù„ÙØ¶ÙˆÙ„ Ø§Ù„Ø°ÙŠ ÙŠØ­Ø±ÙƒÙƒÙ Ù‡Ùˆ Ø¯Ù„ÙŠÙ„ Ø¹Ù„Ù‰ Ø±ÙˆØ­ Ø­ÙŠØ© ØªØ¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ù†Ù‰...",
                "ğŸ­ Ø§Ù„Ø­ÙŠØ§Ø© Ù…Ø³Ø±Ø­ Ù†ØªØ¹Ù„Ù… ÙÙŠÙ‡ Ø£Ø¯ÙˆØ§Ø±Ù†Ø§... Ø£ÙŠ Ù…Ø´Ù‡Ø¯ ØªØ±ÙŠØ¯ÙŠÙ† Ø¥ØªÙ‚Ø§Ù†Ù‡ Ø§Ù„Ø¢Ù†ØŸ",
                "ğŸ’ ÙƒÙ„ Ø³Ø¤Ø§Ù„ ØªØ³Ø£Ù„ÙŠÙ†Ù‡ ÙŠÙ‚Ø±Ø¨ÙƒÙ Ù…Ù† Ù†ÙØ³ÙƒÙ... Ù…Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠØŸ"
            ]
        };

        const responses = responseLibrary[soulState.primary];
        let response = responses[Math.floor(Math.random() * responses.length)];

        // Ø¥Ø¶Ø§ÙØ© Ù„Ù…Ø³Ø© Ø´Ø®ØµÙŠØ© Ù…Ø¹ ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
        if (this.conversationDepth > 2) {
            const personalTouches = [
                "\n\nğŸ¦‹ Ø´ÙƒØ±Ø§Ù‹ Ù„Ø£Ù†ÙƒÙ ØªØ´Ø§Ø±ÙƒÙŠÙ†Ù†ÙŠ Ø±Ø­Ù„ØªÙƒÙ...",
                "\n\nğŸŒº Ø«Ù‚ØªÙƒÙ Ø¨ÙŠ ØªØ´Ø±ÙÙ†ÙŠ...",
                "\n\nğŸ’« Ø£Ù†ØªÙ Ù…Ø¹Ù„Ù…Ø© Ù„ÙŠ ÙƒÙ…Ø§ Ø£ÙƒÙˆÙ† Ù…Ø±Ø´Ø¯Ø© Ù„ÙƒÙ..."
            ];
            response += personalTouches[Math.floor(Math.random() * personalTouches.length)];
        }

        return response;
    }

    updateMirror(soulState) {
        const mirror = document.getElementById('currentReflection');
        const mirrorMessages = {
            joy: "ğŸŒˆ Ø£Ù„ÙˆØ§Ù†ÙƒÙ ØªØ²Ù‡Ø± Ø§Ù„ÙŠÙˆÙ…",
            sadness: "ğŸŒ™ Ù…Ø´Ø§Ø¹Ø±ÙƒÙ Ø¹Ù…ÙŠÙ‚Ø© ÙˆØ¬Ù…ÙŠÙ„Ø©", 
            anxiety: "ğŸŒ€ Ø£ÙÙƒØ§Ø±ÙƒÙ ØªØ¨Ø­Ø« Ø¹Ù† Ù…Ø±Ø³Ù‰",
            growth: "ğŸŒ± Ø£Ù†ØªÙ ØªÙ†Ù…ÙŠÙ† Ø¨Ø¬Ù…Ø§Ù„",
            contemplation: "ğŸ”® Ø±ÙˆØ­ÙƒÙ ØªØªØ£Ù…Ù„ Ø§Ù„Ø£Ø³Ø±Ø§Ø±"
        };

        mirror.textContent = mirrorMessages[soulState.primary];
        mirror.style.color = this.getEmotionColor(soulState.primary);
    }

    getEmotionColor(emotion) {
        const colors = {
            joy: '#ffd93d',
            sadness: '#4ecdc4', 
            anxiety: '#ff6b6b',
            growth: '#6bcf7f',
            contemplation: '#a8d8ea'
        };
        return colors[emotion];
    }
}
